(()=>{"use strict";const t=window.FilteringRT||{};class e{constructor(t){this.wrapper=t,this.stepsParent=t.querySelector(".rt-quiz-steps"),this.steps=this.stepsParent?Array.from(this.stepsParent.querySelectorAll(".rt-step")):[],this.indicatorsParent=t.querySelector(".rt-quiz-indicators"),this.indicators=this.indicatorsParent?Array.from(this.indicatorsParent.querySelectorAll(".rt-quiz-indicator")):[],this.restartBtn=t.querySelector(".rt-quiz-restart"),this.backBtn=t.querySelector(".rt-quiz-back"),this.currentStepIndex=0,this.selections={},this.steps.length&&(this.bindEvents(),this.activateStep(0),this.refreshIndicators(),this.refreshBackButton())}bindEvents(){this.steps.forEach(t=>{const e=t.querySelector(".rt-step-options");e&&e.addEventListener("click",t=>{const e=t.target.closest(".rt-step-option");e&&this.handleOptionSelect(e)})}),this.restartBtn&&this.restartBtn.addEventListener("click",t=>{t.preventDefault(),this.restart()}),this.backBtn&&this.backBtn.addEventListener("click",t=>{t.preventDefault(),this.goBack()}),this.indicatorsParent&&this.indicatorsParent.addEventListener("click",t=>{const e=t.target.closest(".rt-quiz-indicator");if(!e)return;const s=e.getAttribute("data-step"),i=s?parseInt(s,10):NaN;if(!Number.isFinite(i)||i<1)return;const r=i-1;r<=this.currentStepIndex&&this.activateStep(r)})}handleOptionSelect(t){const e=t.getAttribute("data-match-selectitem"),s=t.getAttribute("data-match-step");if(!e||!s)return;this.selections[s]=e;const i=t.querySelector('input[type="radio"], input[type="checkbox"]');i&&(i.checked=!0),this.refreshIndicators(),this.goNext()}goNext(){const t=this.currentStepIndex+1;t>=this.steps.length||this.activateStep(t)}goBack(){const t=this.currentStepIndex-1;t<0||this.activateStep(t)}restart(){this.selections={},this.wrapper.querySelectorAll(".rt-step-option input").forEach(t=>{t.checked=!1}),this.refreshIndicators(!0),this.restartBtn&&this.restartBtn.classList.add("rt--is-hidden"),this.activateStep(0)}activateStep(t){this.currentStepIndex=t,this.steps.forEach((e,s)=>{e.classList.toggle("rt--is-active",s===t)}),this.indicators.forEach(e=>{const s=e.getAttribute("data-step"),i=s?parseInt(s,10):NaN,r=Number.isFinite(i)?i-1:-1;e.classList.toggle("rt--is-active",r===t)}),this.refreshBackButton(),this.restartBtn&&t>0&&this.restartBtn.classList.remove("rt--is-hidden");const e=this.steps[t];e&&e.classList.contains("js-rt-step--results")&&this.loadResultsInto(e)}refreshBackButton(){this.backBtn&&(this.backBtn.disabled=this.currentStepIndex<=0)}refreshIndicators(t=!1){this.indicators.length&&this.indicators.forEach(e=>{const s=e.getAttribute("data-step"),i=s?parseInt(s,10):NaN,r=e.getAttribute("data-name-default")||"",n=e.querySelector(".rt-quiz-indicator-inner");if(!n||!Number.isFinite(i)||i<1)return;if(t)return void(n.textContent=r);const a=i-1,c=this.steps[a];if(!c)return void(n.textContent=r);const o=c.querySelector(".rt-step-option input:checked");if(o){const t=o.closest(".rt-step-option"),e=t?t.getAttribute("data-match-selectitem"):null;return void(n.textContent=e||r)}n.textContent=r})}getAjaxUrl(){return t.ajaxUrl||"/wp-admin/admin-ajax.php"}getNonce(){return t.nonce||this.wrapper.getAttribute("data-nonce")||""}async loadResultsInto(t){t.innerHTML='\n\t\t\t\t<div class="rt-results-loading">\n\t\t\t\t\t<div class="rt-results-loading-item">\n\t\t\t\t\t\t<div class="rt-spinner"></div>\n\t\t\t\t\t\t<strong>Loading results...</strong>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t';const e=new FormData;e.append("action","filtering_get_result"),e.append("selections",JSON.stringify(this.selections));const s=this.getNonce();s&&e.append("_ajax_nonce",s);try{const s=await fetch(this.getAjaxUrl(),{method:"POST",credentials:"same-origin",body:e}),i=await s.text();t.innerHTML=i}catch(e){t.innerHTML='\n\t\t\t\t\t<div class="rt-results-nodata">\n\t\t\t\t\t\tCouldn\'t load results. Please try again.\n\t\t\t\t\t</div>\n\t\t\t\t'}}}function s(){document.querySelectorAll(".js-rt-wrapper, .rt-wrapper").forEach(t=>{t.__filteringRtInstance||(t.__filteringRtInstance=new e(t))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()})();